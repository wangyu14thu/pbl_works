# PBL APP v2.0.1 更新说明

## 更新日期
2026-01-06

## 更新内容

### 1. 项目选择页优化

#### 缩小项目难度星级图标
- **修改位置**：项目选择页的项目卡片
- **修改内容**：将难度星级图标的字体大小从 `1.5rem` 缩小为 `1.1rem`
- **效果**：星级图标更加精致，不会过于抢眼，视觉更加协调

**修改文件：** `assets/css/style.css`
```css
.project-difficulty {
    margin-top: 0.5rem;
    font-size: 1.1rem;  /* 从 1.5rem 改为 1.1rem */
}
```

---

### 2. 城市选择升级为省份+城市级联下拉菜单

#### 功能说明
- **原功能**：城市输入框，需要手动输入
- **新功能**：省份和城市的级联下拉菜单
  - 第一步：选择省份/直辖市/自治区/特别行政区
  - 第二步：根据所选省份，自动更新城市列表
  - 包含**中国所有34个省级行政区**和对应的**地级市**

#### 数据覆盖
✅ **34个省级行政区**：
- 4个直辖市：北京、天津、上海、重庆
- 23个省：河北、山西、辽宁、吉林、黑龙江、江苏、浙江、安徽、福建、江西、山东、河南、湖北、湖南、广东、海南、四川、贵州、云南、陕西、甘肃、青海、台湾
- 5个自治区：内蒙古、广西、西藏、宁夏、新疆
- 2个特别行政区：香港、澳门

✅ **300+个地级市/区**，涵盖中国所有地级行政单位

#### 交互逻辑
1. **初始状态**：
   - 省份下拉框可选
   - 城市下拉框禁用，显示"请先选择省份"

2. **选择省份后**：
   - 城市下拉框自动启用
   - 城市列表自动填充该省份的所有地级市
   - 城市下拉框显示"请选择城市"

3. **表单验证**：
   - 省份和城市都必须选择，否则无法提交
   - 提示信息："请选择省份" / "请选择城市"

#### 修改文件

**1. HTML结构（index.html）**
```html
<!-- 原来的单个城市输入框 -->
<div class="form-group">
    <label for="city">所在城市</label>
    <input type="text" id="city" placeholder="请输入所在城市">
</div>

<!-- 改为省份和城市的级联下拉 -->
<div class="form-group">
    <label for="province">省份</label>
    <select id="province">
        <option value="">请选择省份</option>
    </select>
</div>

<div class="form-group">
    <label for="city">城市</label>
    <select id="city" disabled>
        <option value="">请先选择省份</option>
    </select>
</div>
```

**2. 城市数据文件（assets/js/china-cities.js）**
- 新建文件，包含所有省份和地级市数据
- 数据结构：
```javascript
const chinaCitiesData = {
    "省份名": ["城市1", "城市2", "城市3", ...],
    ...
}
```

**3. JavaScript逻辑（assets/js/script.js）**
- 在 `initRegisterPage()` 中添加省份和城市初始化逻辑
- 动态填充省份选项
- 监听省份改变事件，动态更新城市列表
- 更新表单验证，增加省份和城市的必填验证

**4. CSS样式（assets/css/style.css）**
- 为 `select:disabled` 添加禁用状态样式
- 背景色变灰、鼠标变为禁止图标、透明度降低

**5. Service Worker缓存（service-worker.js）**
- 将新的 `china-cities.js` 文件加入缓存列表
- 缓存版本更新为 `v2.0.0`

#### 用户数据存储
```javascript
userData = {
    nickname: "...",
    gender: "...",
    grade: 3,
    school: "...",
    province: "广东省",  // 新增：省份
    city: "深圳市"        // 修改：从输入改为选择
}
```

---

## 文件变更清单

| 文件 | 变更类型 | 变更内容 |
|-----|---------|---------|
| `index.html` | 修改 | 城市输入框改为省份+城市下拉菜单 |
| `assets/css/style.css` | 修改 | 缩小星级图标字体、添加select禁用样式 |
| `assets/js/script.js` | 修改 | 添加级联下拉逻辑、更新表单验证 |
| `assets/js/china-cities.js` | 新增 | 中国省份和地级市数据 |
| `service-worker.js` | 修改 | 更新缓存版本和文件列表 |

---

## 视觉效果对比

### 项目难度星级

**修改前：**
```
⭐⭐⭐  (字号：1.5rem，较大)
```

**修改后：**
```
⭐⭐⭐  (字号：1.1rem，精致)
```

### 城市选择

**修改前：**
```
┌─────────────────────────────┐
│ 所在城市                     │
│ ┌─────────────────────────┐ │
│ │ 请输入所在城市            │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
（需要手动输入，容易出错）
```

**修改后：**
```
┌─────────────────────────────┐
│ 省份                         │
│ ┌─────────────────────────┐ │
│ │ 请选择省份 ▼              │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
┌─────────────────────────────┐
│ 城市                         │
│ ┌─────────────────────────┐ │
│ │ 请先选择省份 (禁用)       │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘

（选择省份后，城市自动启用）
┌─────────────────────────────┐
│ 省份                         │
│ ┌─────────────────────────┐ │
│ │ 广东省 ▼                  │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
┌─────────────────────────────┐
│ 城市                         │
│ ┌─────────────────────────┐ │
│ │ 请选择城市 ▼              │ │
│ │ 广州市                    │ │
│ │ 深圳市                    │ │
│ │ 珠海市                    │ │
│ │ ...                       │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
（标准化输入，避免错误）
```

---

## 使用体验提升

### 1. 数据准确性
- ✅ 避免用户输入错别字（如"北京"误输为"北经"）
- ✅ 避免不规范输入（如"北京"、"北京市"、"北京 "等不一致）
- ✅ 省份和城市的对应关系正确

### 2. 用户体验
- ✅ 无需手动输入，直接选择，更快捷
- ✅ 级联逻辑清晰，先选省份再选城市
- ✅ 禁用状态明显，防止误操作
- ✅ 下拉菜单支持键盘快速定位（输入首字母）

### 3. 后端友好
- ✅ 数据格式统一，便于后端处理和统计
- ✅ 省份和城市分开存储，便于地域分析
- ✅ 无需额外的数据清洗和校验

---

## 测试要点

### 功能测试
- [x] 页面加载后，省份下拉框显示所有省份
- [x] 初始状态城市下拉框为禁用状态
- [x] 选择省份后，城市下拉框自动启用
- [x] 城市列表正确显示该省份的所有地级市
- [x] 切换省份后，城市列表正确更新
- [x] 未选择省份时，提交提示"请选择省份"
- [x] 未选择城市时，提交提示"请选择城市"
- [x] 选择完整信息后，可以正常提交并跳转

### 数据完整性测试
- [x] 测试所有34个省级行政区是否可选
- [x] 抽查主要省份的地级市列表是否正确
- [x] 直辖市的区列表是否正确（如北京的16个区）

### 样式测试
- [x] 下拉框样式与输入框一致
- [x] 禁用状态样式明显（灰色背景、禁止图标）
- [x] 焦点状态有正确的边框和阴影效果
- [x] 响应式布局正常（移动端显示正常）

### 浏览器兼容性
- [x] Chrome/Edge（最新版）
- [x] Safari（最新版）
- [x] Firefox（最新版）
- [x] 移动端浏览器

---

## 快速测试

访问：http://localhost:8000

1. 打开注册页面
2. 查看省份下拉框（应显示34个选项）
3. 尝试点击城市下拉框（应为禁用状态）
4. 选择"广东省"
5. 城市下拉框自动启用，显示广东的21个地级市
6. 选择"深圳市"
7. 填写其他信息，提交注册

---

## 示例：广东省的城市列表

当用户选择"广东省"后，城市下拉框将显示：
- 广州市
- 韶关市
- 深圳市
- 珠海市
- 汕头市
- 佛山市
- 江门市
- 湛江市
- 茂名市
- 肇庆市
- 惠州市
- 梅州市
- 汕尾市
- 河源市
- 阳江市
- 清远市
- 东莞市
- 中山市
- 潮州市
- 揭阳市
- 云浮市

---

## 版本历史

- **v2.0.1** (2026-01-06) - 优化项目图标大小，升级城市选择为级联下拉
- **v2.0.0** (2026-01-06) - 新增项目三选一功能
- **v1.0.0** (2026-01-05) - 初始版本发布

---

**更新完成！** ✅

测试地址：http://localhost:8000

